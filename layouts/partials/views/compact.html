{{ $item := .item }}
{{ $page := .page }}
{{ $index := .index }}

{{/* Dynamic view adjusts to content type. */}}
{{ $show_authors_only := false }}
{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

<div class="media stream-item view-compact">
  <div class="media-body">

    <div class="section-subheading article-title mb-0 mt-0">
      <a href="{{$link}}" {{ $target | safeHTMLAttr }}>{{ $item.Title }}</a>
    </div>

    <a href="{{$link}}" {{ $target | safeHTMLAttr }} class="summary-link">
      <div class="article-style">
        {{/* 优先使用 summary，其次使用 abstract，最后使用自动生成的 Summary */}}
        {{ $summary := $item.Params.summary | default $item.Params.abstract | default $item.Summary }}
        {{ $summary | plainify | htmlUnescape | truncate 200 | chomp -}}
      </div>
    </a>

    <div class="stream-meta article-metadata">
      {{/* event 类型：只显示地点，不显示日期 */}}
      {{ if eq $item.Type "event" }}
        {{ with $item.Params.location }}
        <div>
          <span>{{ . }}</span>
        </div>
        {{ end }}
      {{ else }}
        {{/* 非 event 类型：正常显示元数据 */}}
        {{ if and $show_authors_only $item.Params.authors }}
        <div>
          {{ partial "page_metadata_authors" $item }}
        </div>
        {{ else if not $show_authors_only }}
          {{ partial "page_metadata" (dict "page" $item "is_list" 1) }}
        {{ end }}
      {{ end }}
    </div>

    {{ if $item.Params.links }}
    <div class="btn-links">
      {{ partial "page_links" (dict "page" $item "is_list" 1) }}
    </div>
    {{ end }}

  </div>
  <div class="ml-3">
    {{ $resource := ($item.Resources.ByType "image").GetMatch "*featured*" }}
    {{ with $resource }}
    {{ $image := .Resize "150x" }}
    <a href="{{$link}}" {{ $target | safeHTMLAttr }}>
      <img src="{{ $image.RelPermalink }}" alt="{{ $item.Title }}" loading="lazy">
    </a>
    {{ end }}
  </div>
</div>